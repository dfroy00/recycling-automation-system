# 系統管理頁面規格

> **版本**：3.0
> **日期**：2026-02-13

## DashboardPage `/dashboard`

- 統計卡片（4 格）：本月車趟數、應收總額、應付總額、待審明細數
- 合約到期提醒列表
- 待審明細列表

## SyncPage `/sync`

- Adapter 連線狀態卡片（POS / 車機）
- 操作按鈕：POS 拉取、車機拉取、產生 Mock 資料
- 同步結果顯示

## UsersPage `/users`（僅 super_admin 可見）

- 資料表格：帳號、姓名、Email、角色、所屬站區、狀態、操作（編輯 / 停用 or 啟用 / 刪除）
- 狀態篩選器：啟用中（預設）/ 已停用 / 全部
- 新增 / 編輯 → Modal 表單
- 角色選擇：super_admin / site_manager / site_staff
- 非 super_admin 角色需選擇所屬站區
- 停用 → Popconfirm「確定停用此使用者？停用後可重新啟用。」→ `PATCH deactivate`（`StopOutlined` warning 色）
- 啟用 → 已停用項目顯示「啟用」按鈕（`CheckCircleOutlined` 綠色）→ `PATCH reactivate` 恢復 active
- 刪除 → Popconfirm「確定刪除此使用者？此操作無法復原。」→ `DELETE` 硬刪除（`DeleteOutlined` danger 色）

## HolidaysPage `/holidays`

- 年份篩選
- 假日列表表格：日期、名稱、操作（刪除）
- 刪除 → Popconfirm「確定刪除此假日？此操作無法復原。」（`DeleteOutlined` danger 色，硬刪除）
- 新增單筆 + 批次匯入

## SchedulePage `/schedule`

- 排程列表：名稱、Cron 表達式、說明、狀態
- 手動觸發按鈕

## Dashboard 卡片 Loading

| 卡片 | Loading 行為 |
|------|-------------|
| 本月車趟數 | 數字區域顯示 Skeleton 灰塊，卡片外框正常 |
| 應收總額 | 同上 |
| 應付總額 | 同上 |
| 待審明細數 | 同上 |
| 合約到期提醒列表 | 表格骨架屏（3 行） |
| 待審明細列表 | 表格骨架屏（3 行） |

- 4 張統計卡片的 API 可並行請求
- 各卡片獨立 loading，先回傳的先顯示

## 使用者表單密碼驗證

### 新增使用者

| 欄位 | 規則 | 錯誤訊息 |
|------|------|---------|
| 帳號 | 必填、4~20 字元、英數字底線 | 「請輸入帳號」/「帳號須為 4~20 字元的英數字或底線」 |
| 密碼 | 必填、≥ 8 字元、含大小寫和數字 | 「請輸入密碼」/「密碼須至少 8 字元，包含大小寫字母和數字」 |
| 確認密碼 | 必填、與密碼一致 | 「請再次輸入密碼」/「兩次密碼不一致」 |
| 姓名 | 必填、最長 50 字 | 「請輸入姓名」 |
| Email | 必填、Email 格式 | 「請輸入 Email」/「Email 格式不正確」 |
| 角色 | 必填 | 「請選擇角色」 |
| 所屬站區 | 非 super_admin 時必填 | 「請選擇所屬站區」 |

### 編輯使用者

- 帳號欄位唯讀
- 密碼欄位選填（留空表示不變更）
- 其餘規則與新增相同

## 假日匯入格式

### 批次匯入規格

- 檔案格式：CSV（UTF-8 BOM）
- 欄位格式：`日期,名稱`（如 `2026-01-01,元旦`）
- 第一行為標題列，自動跳過
- 匯入結果提示：
  - 成功：Toast「匯入完成，共新增 {n} 筆假日」
  - 部分重複：Toast 警告「{m} 筆日期重複已跳過，{n} 筆匯入成功」
  - 格式錯誤：Toast 錯誤「檔案格式不正確，請確認 CSV 格式」

### 匯入 UI

- 上傳區域：拖曳或點擊上傳
- 支援預覽：上傳後先顯示預覽表格，確認後才送出
- 進度提示：「匯入中...」loading 狀態

## 同步進度

### SyncPage 操作進度

| 操作 | 進度顯示 |
|------|---------|
| POS 拉取 | 按鈕 loading +「正在從 POS 系統拉取資料...」 |
| 車機拉取 | 按鈕 loading +「正在從車機系統拉取資料...」 |
| 產生 Mock 資料 | 按鈕 loading +「正在產生測試資料...」 |

- 操作完成後顯示同步結果：
  - 成功：Toast「同步完成，共匯入 {n} 筆資料」+ 結果卡片更新
  - 失敗：Toast 錯誤 + 錯誤詳情顯示在結果區域
- 同步期間禁用其他同步按鈕，避免並行衝突

## 相關規格

- [頁面路由總覽](./pages-overview.md)
- [軟刪除策略](../business-rules/settlement-flow.md#軟刪除策略)
- [UI 規格索引](./README.md)
